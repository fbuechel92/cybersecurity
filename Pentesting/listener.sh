#! /bin/zsh
#
#Description: 
#Listens for connection from remote system
#
#Usage: zsh listener.sh port1 [port2] [port3]

function fileTransfer(){
    while true
    do
        FN=$(nc -nlvp $HOMEPORT2 2>/dev/null)
        if [[ $FN == 'exit' ]] ; then exit ; fi
        nc -nlp $HOMEPORT3 < $FN
    done
}

#Parsing ports into variables
HOMEPORT1=$1
HOMEPORT2=${2:-$((HOMEPORT1+1))}
HOMEPORT3=${3:-$((HOMEPORT2+1))}

#Starting fileTransfer
fileTransfer &

#Listening for connections
nc -nlvp $HOMEPORT1